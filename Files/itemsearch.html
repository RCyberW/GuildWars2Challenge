<div id="search-window">
	<div class="close-button" onclick="closeItemSearchMenu()">X</div>
	<input type="text" id="itemIdsField" placeholder="Item Name..." onkeydown="if(event.keyCode == 13) { $('#searchButton').trigger('click'); };" autofocus>
	<button id="searchButton">Search</button>
	<div id="search-results">
		<table>
			<tbody>
			</tbody>
		</table>
	</div>
</div>
<br>
<div id="add-new-item" class="add-new">Add new Item</div>
<br><br>
<table id="saved-items">
	<thead>
		<tr>
			<th colspan=2 style="width:200px;">Item</th>
			<th style="width:120px;">Current Buy</th>
			<th style="width:120px;">Current Sell</th>
		</tr>
	</thead>
	<tbody></tbody>
</table>
<script src="js/gw2app.js"></script>
<script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
<script>

// click the search button
$("#searchButton").click(function() {
	var itemIds = $("#itemIdsField").val();
	GW2App.getItemIDByName(itemIds, function(response) {
		if (!response.success) { // failed response
			debug("Error from GW2 API: " + response.errorMsg);
		} else { // reload price table
			$("#search-results tbody").empty();
			response.data.forEach(function(item) {
				if (item != null) {
					// Display and hide the search window
					appendRowToMainList(item);
				} else {
					// Display error message
					$("#search-window").append("Error");
				}
			});
		}
	});
});

$('#add-new-item').off('click').on('click', function() {
	$('#search-window').fadeIn(200);
	$('#saved-items').fadeOut(200);
});

function closeItemSearchMenu() {
	$('#search-window').fadeOut(200);
	$('#saved-items').fadeIn(200);
}

// Create a new row in the main result list
function appendRowToMainList(item) {
	// Add item to watch list
	var soldPrice = convertPriceToReadablePrice(item.price.sells.unit_price);
	var buyPrice = convertPriceToReadablePrice(item.price.buys.unit_price);

	$("#saved-items tbody").append(
			"<tr id=" + item.id + ">" + 
			"<td style='background-color:rgb(192,192,192);'><img src='" + item.icon + "' style='width:25px; height:25px'/></td>" + 
			"<td style='background-color:rgb(255,255,255);'>" + item.name + "</td>" + 
			"<td style='background-color:rgb(192,192,192);'>" + buyPrice + "</td>" + 
			"<td style='background-color:rgb(255,255,255);'>" + soldPrice + "</td>" + 
			"<td style='background-color:rgb(192,192,192);'><div onclick='removeRow(" + item.id + ")'>Remove</div></td>" + 
			"</tr>");
	//itemToWatchOutFor, amount, isGreaterThan
	createWatchItem(item.id, 0, true);
	closeItemSearchMenu();
}

// Convert price to a readable value
function convertPriceToReadablePrice(price) {
	var copper = price % 100;
	var silver = price/100 % 100;
	var gold = price/10000;
	
	var retString = "";
	
	if (gold > 0) {
		retString += parseInt(gold) + " G ";
	} 
	if (gold > 0 || silver > 0) {
		retString += parseInt(silver) + " S ";
	} 
	retString += parseInt(copper) + " C";
	
	return retString;
}

// Remove the selected row
function removeRow(rowID) {
	// Remove item from watchlist
	$("#" + rowID).remove();
}
</script>