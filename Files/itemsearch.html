<div id="search-window">
	<div class="close-button" onclick="closeItemSearchMenu()">X</div>
	<input type="text" id="itemIdsField" placeholder="Item Name..." onkeydown="if(event.keyCode == 13) { $('#searchButton').trigger('click'); };" autofocus>
	<button id="searchButton">Search</button>
	<div id="search-results">
		<table>
			<tbody>
				<tr><td>hi Text too long will just get cut hi hi hi hi hi hi hi hi hi hi hi hi hi hi hi hi hi hi hi hi hi hi hi hi hi hi </td><td>add</td></tr>
				<tr><td>hi</td><td>add</td></tr>
				<tr><td>hi</td><td>add</td></tr>
				<tr><td>hi</td><td>add</td></tr>
				<tr><td>hi</td><td>add</td></tr>
				<tr><td>hi</td><td>add</td></tr>
				<tr><td>hi</td><td>add</td></tr>
				<tr><td>hi</td><td>add</td></tr>
				<tr><td>hi</td><td>add</td></tr>
				<tr><td>hi</td><td>add</td></tr>
				<tr><td>hi</td><td>add</td></tr>
			</tbody>
		</table>
	</div>
</div>
<br>
<div id="add-new-item" class="add-new">Add new Item</div>
<br><br>
<table id="saved-items">
	<thead>
		<tr>
			<th>Icon</th>
			<th>Name</th>
			<th>Current Buy</th>
			<th>Current Sell</th>
		</tr>
	</thead>
	<tbody></tbody>
</table>
<script src="js/gw2app.js"></script>
<script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
<script>

// click the search button
$("#searchButton").click(function() {
	var itemIds = $("#itemIdsField").val();
	GW2App.getItemIDByName(itemIds, function(response) {
		if (!response.success) { // failed response
			debug("Error from GW2 API: " + response.errorMsg);
		} else { // reload price table
			$("#search-results tbody").empty();
			response.data.forEach(function(item) {
				var soldPrice = convertPriceToReadablePrice(item.price.sells.unit_price);
				var buyPrice = convertPriceToReadablePrice(item.price.buys.unit_price);
			
				$("#saved-items tbody").append(
						"<tr>" + 
						'<td><img src="' + item.icon + '" style="width:50%; height:50%"/></td>' + 
						"<td>" + item.name + "</td>" + 
						"<td>" + buyPrice + "</td>" + 
						"<td>" + soldPrice + "</td>" + 
						"</tr>");
			});
		}
	});
});

$('#add-new-item').off('click').on('click', function() {
	$('#search-window').fadeIn(200);
	$('#saved-items').fadeOut(200);
});

function closeItemSearchMenu() {
	$('#search-window').fadeOut(200);
	$('#saved-items').fadeIn(200);
}

function convertPriceToReadablePrice(price) {
	var copper = price % 100;
	var silver = price/100 % 100;
	var gold = price/10000;
	
	return parseInt(gold) + " G " + parseInt(silver) + " S " + parseInt(copper) + " C";
}
</script>